{% extends 'base/base.html' %}
{%  block conteudo %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

{% load static %}
<link href="{% static '../static/css/prodcadastrados.css' %}" rel="stylesheet">

</head>
<body>
   <br>
   <div class="container-fluid content">
        <h1>Filtrar Produtos</h1>
        <div class="filter-form">
          <form id="filtro-form">
            <div style="display: flex; align-items: center; justify-content: center;">
                <input type="text" id="codigo_filtro" name="codigo_filtro" placeholder="Código do Produto">
                <input type="text" id="nome_filtro" name="nome_filtro" placeholder="Nome do Produto">
                <input type="number" id="quantidade_filtro" name="quantidade_filtro" placeholder="Quantidade">
            </div>
          </form>
        </div>
    </div>
  
  <!-- Produtos Cadastrados -->
  <div class="container-fluid content">
    <div style="display: flex; align-items: center; justify-content: center;">
      <h1 style="flex: 1;">Lista de Produtos Cadastrados</h1>
      <!-- <label for="file-input" class="export-button">Importar Excel
        <input type="file" id="file-input" class="import-input" accept=".xlsx, .xls, .csv">
      </label> -->
      <button class="export-button" id="atualizar-button">Atualizar</button>
      <button class="export-button">Exportar Excel</button>
    </div>
    <div class="table-container" style="height: 500px; overflow-y: auto;">
      <table>
        <thead>
          <tr>
            <th style="display: none;">_Código</th>
            <th>Código</th>
            <th>Descrição</th>
            <th>Quantidade</th>
            <th>Observação</th>
            <th>link</th>
            <!-- <th>Editar</th>
            <th>Excluir</th> -->
            <th>Dar Baixa</th>
          </tr>
        </thead>
        <!-- Loop para exibir os registros do banco de dados -->
        <tbody>
          {% for codigo, produto_info in produtos.items %}
          <tr>
            <td style="display: none;">{{ codigo }}</td>
            <td>{{ produto_info.sku }}</td>
            <td>{{ produto_info.descricao }}</td>
            <td>{{ produto_info.quantidade }}</td>
            <td>{{ produto_info.obs }}</td>
            <!-- <td>{{ produto_info.url }}</td> -->
            <td><a href="{{ produto_info.url }}" target="_blank">{{ produto_info.url }}</a></td>
            <!-- <td>
              <button class="edit-button"></button>
            </td>
            <td>
              <button class="delete-button" onclick="confirmDelete()"></button>
            </td> -->
            <td>
              <a class="baixa-button" href="{% url 'baixa' item_id=codigo %}?sku={{ produto_info.sku }}&desc={{ produto_info.descricao }}&qtde={{ produto_info.quantidade }}">
                <i class="arrow-icon fas fa-arrow-up"></i>
                <i class="arrow-icon fas fa-arrow-down"></i>
              </a>
          </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
      // Função para realizar o filtro
      function realizarFiltro() {
          var filtroCodigo = $('#codigo_filtro').val().toUpperCase();
          var filtroNome = $('#nome_filtro').val().toUpperCase();
          var filtroQuantidade = parseFloat($('#quantidade_filtro').val()); // Converte para número
  
          $('tbody tr').each(function() {
              var linha = $(this);
              var codigo = linha.find('td:nth-child(2)').text().toUpperCase();
              var nome = linha.find('td:nth-child(3)').text().toUpperCase();
              var quantidade = parseFloat(linha.find('td:nth-child(4)').text());
  
              var codigoPassou = codigo.includes(filtroCodigo) || filtroCodigo === '';
              var nomePassou = nome.includes(filtroNome) || filtroNome === '';
              var quantidadePassou = isNaN(filtroQuantidade) || quantidade >= filtroQuantidade;
  
              if (codigoPassou && nomePassou && quantidadePassou) {
                  linha.show();
              } else {
                  linha.hide();
              }
          });
      }
  
      // Evento input para acionar o filtro
      $('#codigo_filtro, #nome_filtro, #quantidade_filtro').on('input', function() {
          realizarFiltro();
      });
  });
  </script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      const atualizarButton = document.getElementById("atualizar-button");
      
      atualizarButton.addEventListener("click", function() {
          // Faz uma requisição ao servidor para atualizar os dados
          fetch("/produtos/", {
              method: "GET",
          })
          .then(response => response.text())
          .then(data => {
              // Atualiza a página com os novos dados
              document.getElementById("produtos-list").innerHTML = data;
  
              // Faz o refresh da página
              window.location.reload();
          })
          .catch(error => {
              console.error("Erro ao atualizar dados:", error);
          });
      });
  });
  </script>
  

{% endblock %}